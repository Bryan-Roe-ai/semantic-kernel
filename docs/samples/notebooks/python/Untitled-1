import os
import markdown
from bs4 import BeautifulSoup

def strip_markdown(md_text):
    # Convert markdown to HTML, then strip HTML tags for plain text
    html = markdown.markdown(md_text)
    soup = BeautifulSoup(html, "html.parser")
    return soup.get_text(separator="\n")

def collect_md_files(root_dir):
    md_files = []
    for dirpath, _, filenames in os.walk(root_dir):
        for filename in filenames:
            if filename.lower().endswith(".md"):
                md_files.append(os.path.join(dirpath, filename))
    return md_files

def main():
    root_dir = "."  # Change to your workspace root if needed
    output_file = "all_markdown_plaintext.txt"
    md_files = collect_md_files(root_dir)
    with open(output_file, "w", encoding="utf-8") as out:
        for md_file in md_files:
            with open(md_file, "r", encoding="utf-8") as f:
                md_text = f.read()
                plain_text = strip_markdown(md_text)
                out.write(f"--- {md_file} ---\n")
                out.write(plain_text)
                out.write("\n\n")
    print(f"Collected {len(md_files)} markdown files into {output_file}")

if __name__ == "__main__":
    main()