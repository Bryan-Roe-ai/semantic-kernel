consulted: null
contact: SergeyMenshykh
date: 2023-10-23T00:00:00Z
deciders: markwallace-microsoft, matthewbolanos
informed: null
status: accepted

# SK Prompt Syntax for Chat Completion Roles

## Summary
This document outlines the decision to introduce a syntax for defining message roles (such as assistant, system, and user) within SK prompts. This enhancement aims to improve the flexibility and compatibility of SK with various template engines.

## Context and Problem Statement
Currently, SK lacks the ability to designate specific blocks of text in a prompt as messages with defined roles. This limitation hinders the ability to transform prompts into lists of chat messages for use by chat completion connectors. Additionally, different template engines (e.g., Handlebars, Jinja) have unique syntaxes, complicating the representation of chat messages across engines.

## Decision Drivers
- Enable marking text blocks in a prompt as messages with roles for conversion into chat message lists.
- Abstract SK from specific template engine syntaxes by mapping engine-specific syntaxes to SK's message/role syntax.

## Considered Options
1. **Message/role tags generated by functions specified in a prompt.**
2. **Message/role tags generated by a prompt-specific mechanism.**
3. **Message/role tags applied on top of prompt template engines.**

### Option 1: Message/Role Tags Generated by Functions
**Description:**
This option leverages functions within templates to generate message/role tags.

**Example:**
```csharp
internal class SystemFunctions
{
    public string Message(string role)
    {
        return $"<message role=\"{role}\">";
    }
}
```

**Pros:**
- Reusable functions within templates.
- Consistent syntax across supporting template engines.

**Cons:**
- Limited to template engines supporting function calls.
- Requires pre-registration of functions in SK.

### Option 2: Message/Role Tags Generated by Prompt-Specific Mechanism
**Description:**
Utilizes template engine-specific syntax constructions (e.g., helpers, handlers) to generate message/role tags.

**Example:**
```csharp
this.handlebarsEngine.RegisterHelper("system", (EncodedTextWriter output, Context context, Arguments arguments) => {
    // Emit the <message role="system"> tags
});
```

**Pros:**
- Aligns with template engine syntax constructions.
- Optimal for each engine's capabilities.

**Cons:**
- Requires custom callbacks/handlers for each engine.
- Increased complexity in managing multiple engines.

### Option 3: Message/Role Tags Applied on Top of Prompt Template Engines
**Description:**
Specifies SK message/role tags directly within prompts, treating them as regular text.

**Example:**
```xml
<message role="system">
    You are a bank manager. Be helpful, respectful, appreciate diverse language styles.
</message>
<message role="user">
    I want to buy a house.
</message>
```

**Pros:**
- No changes needed in prompt template engines.
- Simple and straightforward implementation.

**Cons:**
- Syntax may not align with template engine constructions.
- Syntax errors detected by SK, not template engines.

## Decision Outcome
We decided to support multiple options to ensure flexibility with new template engines. Initially, we will implement "Option 3: Message/role tags applied on top of prompt template engines" due to its simplicity and ease of integration.

---
